# TextureChannelPacker

**TextureChannelPacker** は、個別のグレースケールテクスチャを1枚の出力テクスチャの R (赤)、G (緑)、B (青)、A (アルファ) チャンネルに効率的にパッキングするための Unreal Engine 5.7 用プラグインです。ORM（オクルージョン、ラフネス、メタリック）マップや、その他のチャンネルパッキングテクスチャを作成する際によく使用されます。

## 機能

- **4チャンネルパッキング (RGBA)**: 最大4枚の入力テクスチャを受け取り、それぞれの赤 (Red) チャンネルを出力テクスチャの R、G、B、A チャンネルに割り当てます。
- **自動リサイズ**: 指定されたターゲット解像度に合わせて、入力テクスチャを自動的にリサイズします。リサイズ処理には高品質なバイリニア補間（`FImageUtils`）が使用されます。
- **入力処理**:
  - 各ソーステクスチャから **Redチャンネル** の値を読み取ります。
  - 入力テクスチャが指定されていない場合、対応する R/G/B チャンネルは黒（0）で埋められます。
  - **Alphaチャンネル (任意)**: Alpha用のテクスチャが指定された場合、その Red チャンネルを使用します。空の場合は、Alphaチャンネルはデフォルトで白（255 / 不透明）に設定されます。
- **拡張フォーマットサポート**:
  - **16bit グレースケール** および **32bit Float (SDF)** のソースフォーマットをサポートしており、「テクスチャが真っ黒になる」問題を防ぎ、高精度なデータを正しく処理します。
- **出力設定**:
  - **圧縮設定**: ドロップダウンメニューから `Masks (推奨)`、`Grayscale`、`Default` を選択できます。
  - 出力先のパス、ファイル名、解像度をカスタマイズ可能です。
  - `sRGB = false` (リニアカラー) で `UTexture2D` アセットを生成します。
- **ユーザーインターフェース**:
  - **パスピッカー**: 出力パスの横にあるフォルダアイコンボタンを使用して、コンテンツブラウザから保存先ディレクトリを簡単に選択できます。
  - **トースト通知**: ログメッセージだけでなく、成功やエラーを分かりやすい通知（トースト通知）でフィードバックします。
  - Unreal Engine エディタの **Tools (ツール)** メニューに統合されています。

## このツールを使う理由 (ブループリント開発者向け)

グラフィックスの最適化に詳しくない方のために、なぜ「チャンネルパッキング」が重要なのか、その3つの主なメリットを説明します。

1.  **サンプラー数の節約**: Unreal Engineのマテリアルには、読み込めるテクスチャの数に制限（通常は16枚）があります。3枚のテクスチャ（AO、ラフネス、メタリックなど）を1枚のファイルにまとめることで、サンプラースロットを2つ節約できます。これにより、「Texture Sampler out of bounds（テクスチャサンプラーの範囲外）」エラーを回避し、より複雑なマテリアルを作成できるようになります。
2.  **メモリ効率 (VRAM) の向上**: 一般的に、3つの別々のファイルを読み込むよりも、1つのテクスチャファイルを読み込む方がグラフィックスメモリ（VRAM）の効率が良くなります。これは、特にスペックの低いハードウェアでゲームをスムーズに動作させるのに役立ちます。
3.  **ファイル管理の改善**: 関連するテクスチャを1つにまとめることで、コンテンツブラウザ内のファイル数が減り、プロジェクトの整理整頓がしやすくなります。

## 要件

- **Unreal Engine 5.5以上** (5.7で開発およびテスト済み)
- C++ プロジェクト (プラグインのコンパイルに必要)

## インストール方法

1. **クローンまたはダウンロード**:
   このリポジトリをダウンロードし、`TextureChannelPacker` フォルダをプロジェクトの `Plugins` ディレクトリに配置してください。
   - `Plugins` フォルダが存在しない場合は、プロジェクトのルートディレクトリ（`.uproject` と同じ階層）に作成してください。

   ディレクトリ構成:
   ```
   MyProject/
   ├── MyProject.uproject
   ├── Plugins/
   │   └── TextureChannelPacker/
   │       ├── TextureChannelPacker.uplugin
   │       └── Source/
   └── Source/
   ```

2. **プロジェクトファイルの生成**:
   `.uproject` ファイルを右クリックし、**Generate Visual Studio project files** を選択します。

3. **プロジェクトのビルド**:
   生成された `.sln` ファイルを IDE（Visual Studio や Rider など）で開き、プロジェクトをビルドします。これによりプラグインがコンパイルされます。

4. **プラグインの有効化**:
   Unreal Engine エディタを起動します。プラグインが自動的に有効になっていない場合は、**Edit (編集) > Plugins (プラグイン)** から **TextureChannelPacker** を検索して有効にしてください。再起動を求められた場合はエディタを再起動します。

## 使用方法

1. **ツールの起動**:
   Unreal Editor のメインメニューバーから **Tools (ツール) > Texture Packing** を選択します。Texture Channel Packer タブが開きます。このタブはエディタレイアウトの任意の場所にドッキングできます。

2. **入力の割り当て**:
   - **Red Channel Input**: 出力の Red チャンネルに格納するテクスチャを選択します（例: アンビエントオクルージョン）。
   - **Green Channel Input**: 出力の Green チャンネルに格納するテクスチャを選択します（例: ラフネス）。
   - **Blue Channel Input**: 出力の Blue チャンネルに格納するテクスチャを選択します（例: メタリック）。
   - **Alpha Channel Input** (任意): 出力の Alpha チャンネルに格納するテクスチャを選択します。空の場合、デフォルトで白 (255) になります。

   *注意: 入力は空のままでも構いません。その場合、R/G/B チャンネルは黒で埋められます。*

3. **出力設定**:
   - **Resolution**: 出力テクスチャの解像度を設定します（例: 2048）。
   - **Compression Settings**: 圧縮タイプを選択します（デフォルトは `Masks`）。
   - **Output Path**: アセットを保存するゲームフォルダのパスを指定します。手動で入力するか、**フォルダアイコン** をクリックしてコンテンツブラウザから選択できます。
   - **File Name**: 新しいテクスチャアセットのファイル名を入力します。

4. **生成**:
   **Generate Texture** ボタンをクリックします。
   - ツールがテクスチャを処理し、指定された場所に新しいアセットをコンテンツブラウザ内に作成します。
   - 処理が完了すると、成功または失敗を知らせるトースト通知が表示されます。

## ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。詳細は [LICENSE](LICENSE) ファイルを参照してください。
